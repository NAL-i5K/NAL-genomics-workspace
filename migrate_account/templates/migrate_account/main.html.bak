{% extends "app/layout.html" %}
{% load staticfiles %}
{% load jsonify %}

{% block head-scripts %}
    {% if iframe == True %}
    <style>
    nav {
        display: none;
    }
    body {
        padding-top: 0px;
    }
    </style>
    {% endif %}
    <link type="text/css" rel="stylesheet" media="all" href="{% static 'blast/css/main.css' %}" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Droid+Serif">
    <link rel="stylesheet" type="text/css" href="//cdn.datatables.net/1.10.5/css/jquery.dataTables.min.css">
    <link rel="stylesheet" type="text/css" href="//cdn.datatables.net/tabletools/2.2.3/css/dataTables.tableTools.css">
    <style type="text/css">
      .Table
      {
      display: table;
      }
      .Title
      {
      display: table-caption;
      text-align: center;
      font-weight: bold;
      font-size: larger;
      }
      .Heading
      {
      display: table-row;
      font-weight: bold;
      text-align: center;
      }
      .Row
      {
      display: table-row;
      }
      .Cell
      {
      display: table-cell;
      border: solid;
      border-width: thin;
      padding-left: 5px;
      padding-right: 5px;
      padding-top: 5px;
      padding-bottom: 5px;
      }
    </style>

    <style>
        .nav-tabs>li.active>a, .nav-tabs>li.active>a:hover, .nav-tabs>li.active>a:focus {
            box-shadow: inset 0 -2px 0 #317eac;
            color: #317eac;
            border: 0px;
        }
    </style>
    <script>
    var user_list = {{ user_list|jsonify }};
    var jbrowse_list = {{ jbrowse_list|jsonify }};
    var blastdb_list = {{ blastdb_list|jsonify }};
    var organism_list =  {{ organism_list|jsonify }};
    var result =  {{ result|jsonify }};
    </script>
{% endblock %}

{% block scripts %}
    <script src="{% static 'blast/scripts/underscore-min.js' %}"></script>
    <script src="{% static 'blast/scripts/jquery.hoverIntent.minified.js' %}"></script>
    <script src="{% static 'blast/scripts/jquery.validate.min.js' %}"></script>
    <script src="{% static 'blast/scripts/blast-multi.js' %}"></script>
    <script type="text/javascript" charset="utf8" src="//cdn.datatables.net/1.10.5/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" charset="utf8" src="//cdn.datatables.net/tabletools/2.2.3/js/dataTables.tableTools.min.js"></script>
{% endblock %}

{% block content %}

{% if user.is_authenticated %}
    <div id="myTabContent" class="tab-content">    
    <div class="tripal_details tab-pane fade active in" role="tabpanel" id="run" aria-labelledby="run-tab">
{% else %}
    <div class="tripal_details">
{% endif %}
<FORM METHOD="POST" id="MainMigrateForm" NAME="MainMigrateForm" ENCTYPE="multipart/form-data" action="add">
{% csrf_token %}
<div class="tripal_organism-info-box tripal-info-box">
<!--<a href="docs/blast_databases.html">-->
<fieldset id="fieldset-datasets">
	<legend>Add Account</legend>
	<div id="box-datasets">
		<div class="datasets-div all">
			<div class="dataset-title"></div>
			<div class"Table"><div class="Title">
			  </div>
			  <div class="Heading">
			    <div class="Cell">
			      <p>Short Name</p>
			    </div>
			    <div class="Cell">
			      <p>Species Name</p>
			    </div>
			    <div class="Cell">
			      <p>Status</p>
			    </div>
			    <div class="Cell">
			      <p>JBrowse URL</p>
			    </div>
			  </div>
			  {% if organism_list %}
    			  {% for o in organism_list  %}
			  <div class="Row">
			    <div class="Cell"><center>
			      {% if user.is_authenticated %}
			      {% for u in user_list %}
			      {% if u.2 == user.id %}
			      {% if o.0 == u.1 %}
			      <a href="" role="button" class="btn btn-success">Confirmed</a>
			      <input type="hidden" name="organism_id" value="{{ o.1 }}">
			      {% else %}
                              {% for r in blastdb_list %}
                              {% if o.0 == r.1%}
                              {% for j in jbrowse_list %}
                              {% if r.0 == j.2 %}
			      <input type="hidden" name="jbrowse_id" value="{{ j.1 }}">
                              {% endif %}
                              {% endfor %}
                              {% endif %}
                              {% endfor %}
			      <input type="submit" value="Add Account"  class="btn btn-warning" />
			      {% endif %}
			      {% endif %}
			      {% endfor %}				 
			      {% else %}
                              <a href="" role="button" class="btn btn-danger">Not Logged In</a>
			      {% endif%}
                            </center></div>
			    <div class="Cell">
			      <p>{{o.2}}</p>
			    </div>
			    <div class="Cell">
			      <p>{{o.1}}</p>
			    </div>
			    <div class="Cell">
			      {% for r in blastdb_list %}
			      {% if o.0 == r.1%}
			      {% for j in jbrowse_list %}
			      {% if r.0 == j.2 %}
			      <a href = {{ j.1 }}>{{ j.1 }}</a>
			      {% endif %}
			      {% endfor %}
			      {% endif %}
			      {% endfor %}
			    </div>
			  </div>			  
			{% endfor %}
			</div>
			{% endif %}
		</div>
	</div>
</div>
</FORM>
</div>


{% endblock %}
